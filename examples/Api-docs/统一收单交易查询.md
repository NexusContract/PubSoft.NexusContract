# 统一收单交易查询

## 功能说明

**接口名称**：`alipay.trade.query`

该接口提供所有支付宝支付订单的查询，商户可以通过该接口主动查询订单状态，完成下一步的业务逻辑。
需要调用查询接口的情况：
当商户后台、网络、服务器等出现异常，商户系统最终未接收到支付通知；
调用支付接口后，返回系统错误或未知交易状态情况；
调用alipay.trade.pay，返回INPROCESS的状态；
调用alipay.trade.cancel之前，需确认支付状态；

## 请求

- **URL**：`/v3/alipay/trade/query`
- **Method**：`POST`
- **Content-Type**：`application/json`

### 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| org_pid | string | 否 | 银行间联模式下有用，其它场景请不要使用；	双联通过该参数指定需要查询的交易所属收单机构的pid; | `2088101117952222` |
| out_trade_no | string | 否 | 订单支付时传入的商户订单号,和支付宝交易号不能同时为空。	trade_no,out_trade_no如果同时存在优先取trade_no | `20150320010101001` |
| query_options | array | 否 | 查询选项，商户传入该参数可定制本接口同步响应额外返回的信息字段，数组格式。 | `["trade_settle_info"]` |
| trade_no | string | 否 | 支付宝交易号，和商户订单号不能同时为空 | `2014112611001004680 073956707` |

## 返回结果

- **Content-Type**：`application/json`

### 返回参数

| 字段名 | 类型 | 说明 | 示例值 |
|--------|------|------|--------|
| additional_status | string | 交易附加状态：	SELLER_NOT_RECEIVED（买家已付款，卖家未收款）； | `SELLER_NOT_RECEIVED` |
| alipay_store_id | string | 支付宝店铺编号 | `2015040900077001000100001232` |
| alipay_sub_merchant_id | string | 间连商户在支付宝端的商户编号；	 只在银行间联交易场景下返回该信息； | `2088301372182171` |
| async_pay_apply_status | string | 异步支付受理状态，仅异步支付模式且query_options指定async_pay_info时返回。S：受理成功，支付宝内部会在一定期限内捞起任务推进支付，直到支付成功或超出可重试期限；其它：受理结果未知，可重试查询。 | `S` |
| auth_trade_pay_mode | string | 预授权支付模式，该参数仅在信用预授权支付场景下返回。信用预授权支付：CREDIT_PREAUTH_PAY | `CREDIT_PREAUTH_PAY` |
| biz_settle_mode | string | 账期结算标识，指已完成支付的订单会进行账期管控，不会实时结算。该参数目前会在使用小程序交易组件场景下返回 | `PERIOD` |
| bkagent_resp_info.bindclrissr_id | string | 枚举值，01 银联；02 网联；03 连通等 | `` |
| bkagent_resp_info.bindpyeracctbk_id | string | 付款机构在清算组织登记或分配的机构代码 | `` |
| bkagent_resp_info.bindtrx_id | string | 原快捷交易流水号 | `` |
| bkagent_resp_info.bkpyeruser_code | string | 用户在银行付款账号的标记化处理编号 | `` |
| bkagent_resp_info.estter_location | string | 设备推测位置 | `` |
| body | string | 订单描述；	只在银行间联交易场景下返回该信息； | `Iphone6 16G` |
| buyer_logon_id | string | 买家支付宝账号 | `159****5620` |
| buyer_open_id | string | 买家支付宝用户唯一标识 | `01501o8f93I3nJAGB1jG4ONxtxV25DCN3Gec3uggnC4CJU0` |
| buyer_pay_amount | string | 买家实付金额，单位为元，两位小数。该金额代表该笔交易买家实际支付的金额，不包含商户折扣等金额 | `8.88` |
| buyer_user_id | string | 买家在支付宝的用户id | `2088101117955611` |
| buyer_user_name | string | 买家名称；	买家为个人用户时为买家姓名，买家为企业用户时为企业名称；	默认不返回该信息，需与支付宝约定后配置返回； | `菜鸟网络有限公司` |
| buyer_user_type | string | 买家用户类型。CORPORATE:企业用户；PRIVATE:个人用户。 | `PRIVATE` |
| cashier_type | string | 收银台类型。 	用户支付的收银台类型，取值如下： 	APP：支付宝APP收银台支付； 	WAP：支付H5收银台支付； 	注：只有在无线产品支付接口请求中query_options指定cashier_type才返回该字段。 | `APP` |
| charge_amount | string | 该笔交易针对收款方的收费金额；单位：元。	 只在银行间联交易场景下返回该信息； | `8.88` |
| charge_flags | string | 费率活动标识。	当交易享受特殊行业或活动费率时，返回该场景的标识。具体场景如下：	trade_special_00：订单优惠费率；	industry_special_on_00：线上行业特殊费率0；	industry_special_on_01：线上行业特殊费率1；	industry_special_00：线下行业特殊费率0；	industry_special_01：线下行业特殊费率1；	bluesea_1：蓝海活动优惠费率标签；	注：只在机构间联模式下返回，其它场景下不返回该字段；  | `bluesea_1` |
| charge_info_list | array | 计费信息列表 | `` |
| credit_biz_order_id | string | 信用业务单号。信用支付场景才有值，先用后付产品里是芝麻订单号。 | `ZMCB99202103310000450000041833` |
| credit_pay_mode | string | 信用支付模式。表示订单是采用信用支付方式（支付时买家没有出资，需要后续履约）。"creditAdvanceV2"表示芝麻先用后付模式，用户后续需要履约扣款。 此字段只有信用支付场景才有值，商户需要根据字段值单独处理。此字段以后可能扩展其他值，建议商户使用白名单方式识别，对于未识别的值做失败处理，并联系支付宝技术支持人员。 | `creditAdvanceV2` |
| discount_amount | string | 平台优惠金额。单位：元。 | `88.88` |
| discount_goods_detail | string | 本次交易支付所使用的单品券优惠的商品优惠信息。	只有在query_options中指定时才返回该字段信息。 | `[{"goods_id":"STANDARD1026181538","goods_name":"雪碧","discount_amount":"100.00","voucher_id":"2015102600073002039000002D5O"}]` |
| enterprise_pay_info.biz_info | string | 因公付业务信息 | `` |
| enterprise_pay_info.invoice_amount | string | 开票金额 | `` |
| enterprise_pay_info.is_use_enterprise_pay | boolean | 是否包含因公付资产 | `` |
| ext_infos | string | 交易额外信息，特殊场景下与支付宝约定返回。	json格式。 | `{"action":"cancel"}` |
| fulfillment_detail_list | array | 履约详情列表。 只有入参的query_options中指定fulfillment_detail_list并且所查询的交易存在履约明细时才返回该字段信息。 | `` |
| fund_bill_list | array | 交易支付使用的资金渠道。	只有在签约中指定需要返回资金明细，或者入参的query_options中指定时才返回该字段信息。 | `` |
| hb_fq_pay_info.fq_amount | string | 用户使用花呗分期支付的金额数。单位：元。 | `10.05` |
| hb_fq_pay_info.user_install_num | string | 用户使用花呗分期支付的分期数 | `3` |
| hyb_amount | string | 惠营宝回票金额。单位：元。 | `10.24` |
| industry_sepc_detail | string | 行业特殊信息（例如在医保卡支付业务中，向用户返回医疗信息）。 | `{"registration_order_pay":{"brlx":"1","cblx":"1"}}` |
| industry_sepc_detail_acc | string | 行业特殊信息-个账相关 | `{"registration_order_pay":{"brlx":"1","cblx":"1"}}` |
| industry_sepc_detail_gov | string | 行业特殊信息-统筹相关 | `{"registration_order_pay":{"brlx":"1","cblx":"1"}}` |
| intact_charge_info_list | array | 完整的收费信息 | `` |
| invoice_amount | string | 交易中用户支付的可开具发票的金额，单位为元，两位小数。该金额代表该笔交易中可以给用户开具发票的金额 | `12.11` |
| mdiscount_amount | string | 商家优惠金额。单位：元。 | `88.88` |
| medical_insurance_info | string | 医保信息。入参的query_options中指定时才返回该字段信息。medicareCardType：医保卡类型，"1":"亲情支付","0":"本人支付"，为空默认为本人支付；medicareCardHolderHiddenName：医保卡持卡人姓名。 | `"{\"medicareCardType\":\"1\",\"medicareCardHolderHiddenName\":\"**华\"}"` |
| open_id | string | 买家支付宝用户号，该字段将废弃，不要使用 | `2088102122524333` |
| out_trade_no | string | 商家订单号 | `6823789339978248` |
| passback_params | string | 公用回传参数。	返回支付时传入的passback_params参数信息 | `merchantBizType%3d3C%26merchantBizNo%3d2016010101111` |
| pay_amount | string | 支付币种订单金额 | `8.88` |
| pay_currency | string | 订单支付币种 | `CNY` |
| payment_info_with_id_list | array | 带支付宝支付id的信息，暂不对外开放 | `` |
| period_scene | string | 该字段用于描述当前账期交易的场景。 | `账期交易的场景。` |
| point_amount | string | 积分支付的金额，单位为元，两位小数。该金额代表该笔交易中用户使用积分支付的金额，比如集分宝或者支付宝实时优惠等 | `10` |
| pre_auth_pay_amount | string | 当用户使用芝麻信用先享后付时，会返回该字段，代表整笔交易的原始待履约金额，单位元。 | `12.46` |
| receipt_amount | string | 实收金额，单位为元，两位小数。该金额为本笔交易，商户账户能够实际收到的金额 | `15.25` |
| receipt_currency_type | string | 收款资金类型，当交易收款资金为数字人民币时返回值为“DC”，否则不返回该字段。 | `DC` |
| req_goods_detail | array | 支付请求的商品明细列表 | `` |
| send_pay_date | string | 本次交易打款给卖家的时间 | `2014-11-27 15:45:57` |
| settle_amount | string | 结算币种订单金额 | `2.96` |
| settle_currency | string | 订单结算币种，对应支付接口传入的settle_currency，支持英镑：GBP、港币：HKD、美元：USD、新加坡元：SGD、日元：JPY、加拿大元：CAD、澳元：AUD、欧元：EUR、新西兰元：NZD、韩元：KRW、泰铢：THB、瑞士法郎：CHF、瑞典克朗：SEK、丹麦克朗：DKK、挪威克朗：NOK、马来西亚林吉特：MYR、印尼卢比：IDR、菲律宾比索：PHP、毛里求斯卢比：MUR、以色列新谢克尔：ILS、斯里兰卡卢比：LKR、俄罗斯卢布：RUB、阿联酋迪拉姆：AED、捷克克朗：CZK、南非兰特：ZAR | `USD` |
| settle_trans_rate | string | 结算币种兑换标价币种汇率 | `30.025` |
| settlement_id | string | 支付清算编号，用于清算对账使用；	只在银行间联交易场景下返回该信息； | `2018101610032004620239146945` |
| store_id | string | 商户门店编号 | `NJ_S_001` |
| store_name | string | 请求交易支付中的商户店铺的名称 | `证大五道口店` |
| subject | string | 订单标题；	 只在银行间联交易场景下返回该信息； | `Iphone6 16G` |
| tap_pay_info.payment_medium_type | string | 碰一下支付的支付介质类型，标识当前支付为碰一下支付 | `` |
| tap_pay_info.total_discount_amount | string | 碰一下支付的碰一下共减优惠金额 | `` |
| tap_pay_info.total_discount_name | string | 碰一下支付的碰一下共减金额展示名称 | `` |
| terminal_id | string | 商户机具终端编号 | `NJ_T_001` |
| total_amount | string | 交易的订单金额，单位为元，两位小数。该参数的值为支付时传入的total_amount | `88.88` |
| trade_no | string | 支付宝交易号 | `2013112011001004330000121536` |
| trade_settle_info.trade_settle_detail_list | array | 交易结算明细信息 | `` |
| trade_settle_info.trade_unsettled_amount | string | 直付通账期、直连账期下返回，其他场景为空，表示一笔订单剩余待结算金额 | `1.1` |
| trade_status | string | 交易状态：WAIT_BUYER_PAY（交易创建，等待买家付款）、TRADE_CLOSED（未付款交易超时关闭，或支付完成后全额退款）、TRADE_SUCCESS（交易支付成功）、TRADE_FINISHED（交易结束，不可退款） | `TRADE_CLOSED` |
| trans_currency | string | 标价币种，该参数的值为支付时传入的trans_currency，支持英镑：GBP、港币：HKD、美元：USD、新加坡元：SGD、日元：JPY、加拿大元：CAD、澳元：AUD、欧元：EUR、新西兰元：NZD、韩元：KRW、泰铢：THB、瑞士法郎：CHF、瑞典克朗：SEK、丹麦克朗：DKK、挪威克朗：NOK、马来西亚林吉特：MYR、印尼卢比：IDR、菲律宾比索：PHP、毛里求斯卢比：MUR、以色列新谢克尔：ILS、斯里兰卡卢比：LKR、俄罗斯卢布：RUB、阿联酋迪拉姆：AED、捷克克朗：CZK、南非兰特：ZAR、人民币：CNY、新台币：TWD。当trans_currency 和 settle_currency 不一致时，trans_currency支持人民币：CNY、新台币：TWD | `TWD` |
| trans_pay_rate | string | 标价币种兑换支付币种汇率 | `0.264` |
| voucher_detail_list | array | 本交易支付时使用的所有优惠券信息。	只有在query_options中指定时才返回该字段信息。 | `` |

### 成功响应示例

```json
{
  "code": "10000",
  "msg": "Success",
  "additional_status": "SELLER_NOT_RECEIVED",
  "alipay_store_id": "2015040900077001000100001232",
  "alipay_sub_merchant_id": "2088301372182171",
  "async_pay_apply_status": "S",
  "auth_trade_pay_mode": "CREDIT_PREAUTH_PAY",
  "biz_settle_mode": "PERIOD",
  "bkagent_resp_info": {
    "bindclrissr_id": "string",
    "bindpyeracctbk_id": "string",
    "bindtrx_id": "string",
    "bkpyeruser_code": "string",
    "estter_location": "string"
  },
  "body": "Iphone6 16G",
  "buyer_logon_id": "159****5620",
  "buyer_open_id": "01501o8f93I3nJAGB1jG4ONxtxV25DCN3Gec3uggnC4CJU0",
  "buyer_pay_amount": "8.88",
  "buyer_user_id": "2088101117955611",
  "buyer_user_name": "菜鸟网络有限公司",
  "buyer_user_type": "PRIVATE",
  "cashier_type": "APP",
  "charge_amount": "8.88",
  "charge_flags": "bluesea_1",
  "charge_info_list": [
    {
      "charge_fee": "string",
      "charge_type": "string",
      "is_rating_on_switch": "string",
      "is_rating_on_trade_receiver": "string",
      "original_charge_fee": "string",
      "sub_fee_detail_list": [
        {
          "charge_fee": "string",
          "original_charge_fee": "string",
          "switch_fee_rate": "string"
        }
      ],
      "switch_fee_rate": "string"
    }
  ],
  "credit_biz_order_id": "ZMCB99202103310000450000041833",
  "credit_pay_mode": "creditAdvanceV2",
  "discount_amount": "88.88",
  "discount_goods_detail": "[{\"goods_id\":\"STANDARD1026181538\",\"goods_name\":\"雪碧\",\"discount_amount\":\"100.00\",\"voucher_id\":\"2015102600073002039000002D5O\"}]",
  "enterprise_pay_info": {
    "biz_info": "string",
    "invoice_amount": "string",
    "is_use_enterprise_pay": "boolean"
  },
  "ext_infos": "{\"action\":\"cancel\"}",
  "fulfillment_detail_list": [
    {
      "fulfillment_amount": "80.00",
      "gmt_payment": "2021-03-17 09:45:57",
      "out_request_no": "20200320010101001"
    }
  ],
  "fund_bill_list": [
    {
      "amount": "string",
      "bank_code": "string",
      "fund_channel": "string",
      "fund_type": "string",
      "real_amount": "string"
    }
  ],
  "hb_fq_pay_info": {
    "fq_amount": "10.05",
    "user_install_num": "3"
  },
  "hyb_amount": "10.24",
  "industry_sepc_detail": "{\"registration_order_pay\":{\"brlx\":\"1\",\"cblx\":\"1\"}}",
  "industry_sepc_detail_acc": "{\"registration_order_pay\":{\"brlx\":\"1\",\"cblx\":\"1\"}}",
  "industry_sepc_detail_gov": "{\"registration_order_pay\":{\"brlx\":\"1\",\"cblx\":\"1\"}}",
  "intact_charge_info_list": [
    {
      "actual_amount": "0.01",
      "bill_type": "1",
      "gmt_pay": "2023-05-16 22:22:22",
      "is_refund": "true",
      "out_biz_no": "2323232323",
      "plan_amount": "0.02",
      "product_name": "ALI_ESCROW",
      "service_target": "2023232",
      "service_type": "TRADE",
      "status": "1",
      "target_account_no": "20880156",
      "target_user_id": "2088"
    }
  ],
  "invoice_amount": "12.11",
  "mdiscount_amount": "88.88",
  "medical_insurance_info": "\"{\\\"medicareCardType\\\":\\\"1\\\",\\\"medicareCardHolderHiddenName\\\":\\\"**华\\\"}\"",
  "open_id": "2088102122524333",
  "out_trade_no": "6823789339978248",
  "passback_params": "merchantBizType%3d3C%26merchantBizNo%3d2016010101111",
  "pay_amount": "8.88",
  "pay_currency": "CNY",
  "payment_info_with_id_list": [
    {
      "payment_ids": [
        "string"
      ],
      "type": "PAY"
    }
  ],
  "period_scene": "账期交易的场景。",
  "point_amount": "10",
  "pre_auth_pay_amount": "12.46",
  "receipt_amount": "15.25",
  "receipt_currency_type": "DC",
  "req_goods_detail": [
    {
      "alipay_goods_id": "string",
      "body": "string",
      "categories_tree": "string",
      "goods_category": "string",
      "goods_id": "string",
      "goods_name": "string",
      "out_item_id": "string",
      "out_sku_id": "string",
      "price": "string",
      "quantity": "integer",
      "show_url": "string"
    }
  ],
  "send_pay_date": "2014-11-27 15:45:57",
  "settle_amount": "2.96",
  "settle_currency": "USD",
  "settle_trans_rate": "30.025",
  "settlement_id": "2018101610032004620239146945",
  "store_id": "NJ_S_001",
  "store_name": "证大五道口店",
  "subject": "Iphone6 16G",
  "tap_pay_info": {
    "payment_medium_type": "string",
    "total_discount_amount": "string",
    "total_discount_name": "string"
  },
  "terminal_id": "NJ_T_001",
  "total_amount": "88.88",
  "trade_no": "2013112011001004330000121536",
  "trade_settle_info": {
    "trade_settle_detail_list": [
      {
        "amount": "10.00",
        "operation_dt": "2019-05-16 09:59:17",
        "operation_serial_no": "2321232323232",
        "operation_type": "replenish",
        "ori_trans_in": "2088111111111111",
        "ori_trans_out": "2088111111111111",
        "trans_in": "2088111111111111",
        "trans_out": "2088111111111111"
      }
    ],
    "trade_unsettled_amount": "1.1"
  },
  "trade_status": "TRADE_CLOSED",
  "trans_currency": "TWD",
  "trans_pay_rate": "0.264",
  "voucher_detail_list": [
    {
      "amount": "string",
      "id": "string",
      "memo": "string",
      "merchant_contribute": "string",
      "name": "string",
      "other_contribute": "string",
      "other_contribute_detail": [
        {
          "contribute_amount": "string",
          "contribute_type": "string"
        }
      ],
      "purchase_ant_contribute": "string",
      "purchase_buyer_contribute": "string",
      "purchase_merchant_contribute": "string",
      "template_id": "string",
      "type": "string"
    }
  ]
}
```

### 失败响应示例

```json
{
  "code": "40004",
  "msg": "Business Failed",
  "sub_code": "ACQ.TRADE_HAS_SUCCESS",
  "sub_msg": "交易已被支付"
}
```

## 状态码说明

| 状态码 | 说明 |
|--------|------|
| 10000  | 业务处理成功 |
| 40004  | 业务处理失败 |
| 20000  | 服务不可用 |

## 请求示例 (cURL)

```bash
curl -X POST https://openapi.alipay.com/v3/alipay/trade/query \
  -H "Content-Type: application/json" \
  -d '{
  "org_pid": "2088101117952222",
  "out_trade_no": "20150320010101001",
  "query_options": [
    "string"
  ],
  "trade_no": "2014112611001004680 073956707"
}'
```
