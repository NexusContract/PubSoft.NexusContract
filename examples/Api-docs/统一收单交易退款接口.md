# 统一收单交易退款接口

## 功能说明

**接口名称**：`alipay.trade.refund`

当交易发生之后一段时间内，由于买家或者卖家的原因需要退款时，卖家可以通过退款接口将支付款退还给买家，支付宝将在收到退款请求并且验证成功之后，按照退款规则将支付款按原路退到买家帐号上。
交易超过约定时间（签约时设置的可退款时间）的订单无法进行退款。 
支付宝退款支持单笔交易分多次退款，多次退款需要提交原支付订单的订单号和设置不同的退款请求号。一笔退款失败后重新提交，要保证重试时退款请求号不能变更，防止该笔交易重复退款。 
同一笔交易累计提交的退款金额不能超过原始交易总金额。

## 请求

- **URL**：`/v3/alipay/trade/refund`
- **Method**：`POST`
- **Content-Type**：`application/json`

### 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| goods_detail | array | 否 | 退款包含的商品列表信息，Json格式。 | `` |
| operator_id | string | 否 | 商户的操作员编号 | `OP001` |
| org_pid | string | 否 | 银行间联模式下有用，其它场景请不要使用；	双联通过该参数指定需要退款的交易所属收单机构的pid; | `2088101117952222` |
| out_request_no | string | 否 | 退款请求号。	标识一次退款请求，需要保证在交易号下唯一，如需部分退款，则此参数必传。	注：针对同一次退款请求，如果调用接口失败或异常了，重试时需要保证退款请求号不能变更，防止该笔交易重复退款。支付宝会保证同样的退款请求号多次请求只会退一次。 | `HZ01RF001` |
| out_trade_no | string | 否 | 商户订单号。	订单支付时传入的商户订单号，商家自定义且保证商家系统中唯一。与支付宝交易号 trade_no 不能同时为空。 | `20150320010101001` |
| query_options | array | 否 | 查询选项。	商户通过上送该参数来定制同步需要额外返回的信息字段，数组格式。 | `["refund_detail_item_list"]` |
| refund_advance_account | string | 否 | 指定垫资退款账号主体，可能是用户id或登录名 | `loginname@alitest.com` |
| refund_advance_account_type | string | 否 | 指定垫资退款账号的类型，取值范围：default，userId，loginName | `loginName` |
| refund_amount | string | 否 | 退款金额。	需要退款的金额，该金额不能大于订单金额，单位为元，支持两位小数。	注：如果正向交易使用了营销，该退款金额包含营销金额，支付宝会按业务规则分配营销和买家自有资金分别退多少，默认优先退买家的自有资金。如交易总金额100元，用户支付时使用了80元自有资金和20元无资金流的营销券，商家实际收款80元。如果首次请求退款60元，则60元全部从商家收款资金扣除退回给用户自有资产；如果再请求退款40元，则从商家收款资金扣除20元退回用户资产以及把20元的营销券退回给用户（券是否可再使用取决于券的规则配置）。 | `200.12` |
| refund_currency | string | 否 | 订单退款币种信息。支持英镑：GBP、港币：HKD、美元：USD、新加坡元：SGD、日元：JPY、加拿大元：CAD、澳元：AUD、欧元：EUR、新西兰元：NZD、韩元：KRW、泰铢：THB、瑞士法郎：CHF、瑞典克朗：SEK、丹麦克朗：DKK、挪威克朗：NOK、马来西亚林吉特：MYR、印尼卢比：IDR、菲律宾比索：PHP、毛里求斯卢比：MUR、以色列新谢克尔：ILS、斯里兰卡卢比：LKR、俄罗斯卢布：RUB、阿联酋迪拉姆：AED、捷克克朗：CZK、南非兰特：ZAR、人民币：CNY | `USD` |
| refund_goods_detail | array | 否 | 退款包含的商品列表信息 | `` |
| refund_reason | string | 否 | 退款原因说明。	商家自定义，将在会在商户和用户的pc退款账单详情中展示 | `正常退款` |
| refund_royalty_parameters | array | 否 | 退分账明细信息。	 注： 1.当面付且非直付通模式无需传入退分账明细，系统自动按退款金额与订单金额的比率，从收款方和分账收入方退款，不支持指定退款金额与退款方。 	2.直付通模式，电脑网站支付，手机 APP 支付，手机网站支付产品，须在退款请求中明确是否退分账，从哪个分账收入方退，退多少分账金额；如不明确，默认从收款方退款，收款方余额不足退款失败。不支持系统按比率退款。 | `` |
| refund_trans_out | string | 否 | 指定退款账号，对应指定账号退款合约中的约定账号		与refund_trans_out_type绑定使用	1、refund_trans_out_type=userId时，传入对应的支付宝2088账号	2、refund_trans_out_type=loginName时，传入对应的支付宝账号登录名 | `2088xxxxxxxxxxxx` |
| refund_trans_out_type | string | 否 | 指定退款账号类型	userId：支付宝账号id	loginName：支付宝账号登录名 | `userId` |
| related_settle_confirm_no | string | 否 | 针对账期交易，在确认结算后退款的话，需要指定确认结算时的结算单号。 | `2024041122001495000530302869` |
| store_id | string | 否 | 商户门店编号，由商家自定义。需保证当前商户下唯一。 | `NJ_S_001` |
| terminal_id | string | 否 | 商户的终端编号 | `NJ_T_001` |
| trade_no | string | 否 | 支付宝交易号。	和商户订单号 out_trade_no 不能同时为空，两者同时存在时，优先取值trade_no | `2014112611001004680073956707` |

## 返回结果

- **Content-Type**：`application/json`

### 返回参数

| 字段名 | 类型 | 说明 | 示例值 |
|--------|------|------|--------|
| buyer_logon_id | string | 用户的登录id | `159****5620` |
| buyer_open_id | string | 买家支付宝用户唯一标识 | `074a1CcTG1LelxKe4xQC0zgNdId0nxi95b5lsNpazWYoCo5` |
| buyer_user_id | string | 买家在支付宝的用户id | `2088101117955611` |
| fund_change | string | 本次退款是否发生了资金变化 | `Y` |
| gmt_refund_pay | string | 退款支付时间 | `2014-11-27 15:45:57` |
| has_deposit_back | string | 是否有银行卡冲退，仅当query_options中传入deposit_back_info时返回 | `true` |
| open_id | string | 买家支付宝用户号，该参数已废弃，请不要使用 | `2088102122524333` |
| out_trade_no | string | 商户订单号 | `6823789339978248` |
| pre_auth_cancel_fee | string | 当用户使用芝麻信用先享后付时，且当前的操作为预授权撤销动作时，会返回该字段，代表当前撤销的预授权金额，单位元。 | `12.45` |
| present_refund_buyer_amount | string | 本次退款金额中买家退款金额;单位：元。	该字段默认不返回； | `88.88` |
| present_refund_discount_amount | string | 本次退款金额中平台优惠退款金额；单位：元。	该字段默认不返回； | `88.88` |
| present_refund_mdiscount_amount | string | 本次退款金额中商家优惠退款金额；单位：元。	该字段默认不返回； | `88.88` |
| refund_charge_amount | string | 本次退款针对收款方的退收费金额；单位：元。	只在机构间联模式下返回，其它场景下不返回该字段； | `8.88` |
| refund_charge_info_list | array | 退费信息 | `` |
| refund_currency | string | 退款币种信息 | `USD` |
| refund_detail_item_list | array | 退款使用的资金渠道。	只有在签约中指定需要返回资金明细，或者入参的query_options中指定时才返回该字段信息。 | `` |
| refund_fee | string | 退款总金额。单位：元。	指该笔交易累计已经退款成功的金额。 | `88.88` |
| refund_hyb_amount | string | 本次请求退惠营宝金额。单位：元。 | `10.24` |
| refund_preset_paytool_list.amount | array | 前置资产金额。单位：元。 | `12.21` |
| refund_preset_paytool_list.assert_type_code | string | 前置资产类型编码，和收单支付传入的preset_pay_tool里面的类型编码保持一致。 | `HEMA` |
| refund_settlement_id | string | 退款清算编号，用于清算对账使用；	只在机构间联模式下返回，其它场景下不返回该字段； | `2018101610032004620239146945` |
| refund_voucher_detail_list | array | 本交易支付时使用的所有优惠券信息。 只有在query_options中指定了refund_voucher_detail_list时才返回该字段信息。 | `` |
| send_back_fee | string | 本次商户实际退回金额。单位：元。	说明：如需获取该值，需在入参query_options中传入 refund_detail_item_list。 | `1.8` |
| store_name | string | 交易在支付时候的门店名称 | `望湘园联洋店` |
| trade_no | string | 支付宝交易号 | `2013112011001004330000121536` |

### 成功响应示例

```json
{
  "code": "10000",
  "msg": "Success",
  "buyer_logon_id": "159****5620",
  "buyer_open_id": "074a1CcTG1LelxKe4xQC0zgNdId0nxi95b5lsNpazWYoCo5",
  "buyer_user_id": "2088101117955611",
  "fund_change": "Y",
  "gmt_refund_pay": "2014-11-27 15:45:57",
  "has_deposit_back": "true",
  "open_id": "2088102122524333",
  "out_trade_no": "6823789339978248",
  "pre_auth_cancel_fee": "12.45",
  "present_refund_buyer_amount": "88.88",
  "present_refund_discount_amount": "88.88",
  "present_refund_mdiscount_amount": "88.88",
  "refund_charge_amount": "8.88",
  "refund_charge_info_list": [
    {
      "charge_type": "string",
      "refund_charge_fee": "string",
      "refund_sub_fee_detail_list": [
        {
          "refund_charge_fee": "string",
          "switch_fee_rate": "string"
        }
      ],
      "switch_fee_rate": "string"
    }
  ],
  "refund_currency": "USD",
  "refund_detail_item_list": [
    {
      "amount": "string",
      "bank_code": "string",
      "fund_channel": "string",
      "fund_type": "string",
      "real_amount": "string"
    }
  ],
  "refund_fee": "88.88",
  "refund_hyb_amount": "10.24",
  "refund_preset_paytool_list": {
    "amount": [
      "string"
    ],
    "assert_type_code": "HEMA"
  },
  "refund_settlement_id": "2018101610032004620239146945",
  "refund_voucher_detail_list": [
    {
      "amount": "string",
      "id": "string",
      "memo": "string",
      "merchant_contribute": "string",
      "name": "string",
      "other_contribute": "string",
      "other_contribute_detail": [
        {
          "contribute_amount": "string",
          "contribute_type": "string"
        }
      ],
      "purchase_ant_contribute": "string",
      "purchase_buyer_contribute": "string",
      "purchase_merchant_contribute": "string",
      "template_id": "string",
      "type": "string"
    }
  ],
  "send_back_fee": "1.8",
  "store_name": "望湘园联洋店",
  "trade_no": "2013112011001004330000121536"
}
```

### 失败响应示例

```json
{
  "code": "40004",
  "msg": "Business Failed",
  "sub_code": "ACQ.TRADE_HAS_SUCCESS",
  "sub_msg": "交易已被支付"
}
```

## 状态码说明

| 状态码 | 说明 |
|--------|------|
| 10000  | 业务处理成功 |
| 40004  | 业务处理失败 |
| 20000  | 服务不可用 |

## 请求示例 (cURL)

```bash
curl -X POST https://openapi.alipay.com/v3/alipay/trade/refund \
  -H "Content-Type: application/json" \
  -d '{
  "goods_detail": [
    {
      "alipay_goods_id": "string",
      "body": "string",
      "categories_tree": "string",
      "goods_category": "string",
      "goods_id": "string",
      "goods_name": "string",
      "out_item_id": "string",
      "out_sku_id": "string",
      "price": "string",
      "quantity": "integer",
      "show_url": "string"
    }
  ],
  "operator_id": "OP001",
  "org_pid": "2088101117952222",
  "out_request_no": "HZ01RF001",
  "out_trade_no": "20150320010101001",
  "query_options": [
    "string"
  ],
  "refund_advance_account": "loginname@alitest.com",
  "refund_advance_account_type": "loginName",
  "refund_amount": "200.12",
  "refund_currency": "USD",
  "refund_goods_detail": [
    {
      "goods_id": "apple-01",
      "out_certificate_no_list": [
        "string"
      ],
      "out_item_id": "outItem_01",
      "out_sku_id": "outSku_01",
      "refund_amount": "19.50"
    }
  ],
  "refund_reason": "正常退款",
  "refund_royalty_parameters": [
    {
      "amount": "string",
      "amount_percentage": "integer",
      "desc": "string",
      "royalty_scene": "string",
      "royalty_type": "string",
      "trans_in": "string",
      "trans_in_name": "string",
      "trans_in_type": "string",
      "trans_out": "string",
      "trans_out_type": "string"
    }
  ],
  "refund_trans_out": "2088xxxxxxxxxxxx",
  "refund_trans_out_type": "userId",
  "related_settle_confirm_no": "2024041122001495000530302869",
  "store_id": "NJ_S_001",
  "terminal_id": "NJ_T_001",
  "trade_no": "2014112611001004680073956707"
}'
```
