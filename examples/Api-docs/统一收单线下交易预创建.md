# 统一收单线下交易预创建

## 功能说明

**接口名称**：`alipay.trade.precreate`

收银员通过收银台或商户后台调用支付宝接口，生成二维码后，展示给用户，由用户扫描二维码完成订单支付。

## 请求

- **URL**：`/v3/alipay/trade/precreate`
- **Method**：`POST`
- **Content-Type**：`application/json`

### 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| alipay_store_id | string | 否 | 支付宝店铺编号。	指商户创建门店后支付宝生成的门店ID。 | `2016052600077000000015640104` |
| bkagent_req_info.acq_code | string | 否 | 收单机构在清算组织登记或分配的机构代码 | `` |
| bkagent_req_info.device_type | string | 否 | 终端设备类型，受理方可参考终端注册时的设备类型填写。 | `` |
| bkagent_req_info.location | string | 否 | 终端设备实时经纬度信息，格式为纬度/经度，+表示北纬、东经，-表示南纬、西经。 | `` |
| bkagent_req_info.merch_code | string | 否 | 收单机构在清算组织登记的商户编码 | `` |
| bkagent_req_info.serial_num | string | 否 | 终端类型填写为 02、	03、04、05、06、08、09 或 10 时，必	须填写终端序列号。 | `` |
| body | string | 否 | 订单附加信息。	如果请求时传递了该参数，将在异步通知、对账单中原样返回，同时会在商户和用户的pc账单详情中作为交易描述展示 | `Iphone6 16G` |
| business_params.actual_order_time | string | 否 | 实际订单时间，在乘车码场景，传入的是用户刷码乘车时间 | `` |
| business_params.buyer_memo | string | 否 | 买家备注信息 | `` |
| business_params.campus_card | string | 否 | 校园卡编号 | `` |
| business_params.card_type | string | 否 | 虚拟卡卡类型 | `` |
| business_params.enterprise_pay_amount | string | 否 | 因公付金额，单位：元。 | `` |
| business_params.enterprise_pay_info | string | 否 | 因公付业务信息 | `` |
| business_params.force_pwd | string | 否 | 收银台强制密码核身参数，实际收银侧会根据这个参数为true并结合业务场景来判断是否密码核身 | `` |
| business_params.good_taxes | string | 否 | 商户传入的交易税费。需要落地风控使用 | `` |
| business_params.mc_create_trade_ip | string | 否 | 商户端创建订单的 IP，须上传正确的用户端外网 IP，支持 ipv4/ipv6 格式；	mc_create_trade_ip和mcCreateTradeIp（旧）参数描述相同，首选mc_create_trade_ip入参，请勿重复入参；	如已入参mcCreateTradeIp（旧），无需新增入参mc_create_trade_ip。 | `` |
| business_params.priority_unfreeze_asset | string | 否 | 信用预授权转交易阶段，优先解冻的用户资产	CREDIT_ASSET：信用资产	COMMON_ASSET：自有资金资产	默认优先解冻资金资产 | `` |
| business_params.tiny_app_merchant_biz_type | string | 否 | 当需要在 商家平台（b.alipay.com）—数据中心 中查看对应业务场景下的数据明细可以通过该参数传入	支持传入的值：<a target="_blank" href="https://opendocs.alipay.com/mini/08by8k?pathHash=96e03412">小程序细分业务场景</a> | `` |
| buyer_logon_id | string | 否 | 买家支付宝账号 | `15901825620` |
| code_type | string | 否 | 码类型，如果请求时传入了share_code，将在响应参数返回吱口令；如果为空，则默认为订单码 | `share_code` |
| disable_pay_channels | string | 否 | 禁用渠道,用户不可用指定渠道支付，多个渠道以逗号分割	注，与enable_pay_channels互斥	<a href="https://docs.open.alipay.com/common/wifww7">渠道列表</a> | `pcredit,moneyFund,debitCardExpress` |
| discountable_amount | string | 否 | 可打折金额。	参与优惠计算的金额，单位为元，精确到小数点后两位，取值范围[0.01,100000000]。 	如果同时传入了【可打折金额】、【不可打折金额】和【订单总金额】，则必须满足如下条件：【订单总金额】=【可打折金额】+【不可打折金额】。	如果订单金额全部参与优惠计算，则【可打折金额】和【不可打折金额】都无需传入。 | `80.00` |
| enable_pay_channels | string | 否 | 指定支付渠道。	用户只能使用指定的渠道进行支付，多个渠道以逗号分割。	与disable_pay_channels互斥，支持传入的值：<a target="_blank" href="https://docs.open.alipay.com/common/wifww7">渠道列表</a>。	注：如果传入了指定支付渠道，则用户只能用指定内的渠道支付，包括营销渠道也要指定才能使用。该参数可能导致用户支付受限，慎用。 | `pcredit,moneyFund,debitCardExpress` |
| ext_user_info.cert_no | string | 否 | 买家证件号。	注：need_check_info=T或fix_buyer=T时该参数才有效，支付宝会比较买家在支付宝留存的证件号码与该参数传入的值是否匹配。 | `` |
| ext_user_info.cert_type | string | 否 | 指定买家证件类型。	枚举值：	IDENTITY_CARD：身份证；	PASSPORT：护照；	OFFICER_CARD：军官证；	SOLDIER_CARD：士兵证；	HOKOU：户口本；	PERMANENT_RESIDENCE_FOREIGNER：外国人永久居留身份证。	如有其它类型需要支持，请与蚂蚁金服工作人员联系。	注： need_check_info=T或fix_buyer=T时该参数才有效，支付宝会比较买家在支付宝留存的证件类型与该参数传入的值是否匹配。 | `` |
| ext_user_info.fix_buyer | string | 否 | 是否强制校验买家身份。	需要强制校验传：T;	不需要强制校验传：F或者不传；	当传T时，接口上必须指定cert_type、cert_no和name信息且支付宝会校验传入的信息跟支付买家的信息都匹配，否则报错。	默认为不校验。 | `` |
| ext_user_info.identity_hash | string | 否 | 买家加密身份信息。当指定了此参数且指定need_check_info=T时，支付宝会对买家身份进行校验，校验逻辑为买家姓名、买家证件号拼接后的字符串，以sha256算法utf-8编码计算hash，若与传入的值不匹配则会拦截本次支付。注意：如果同时指定了用户明文身份信息（name，cert_type，cert_no中任意一个），则忽略identity_hash以明文参数校验。 | `` |
| ext_user_info.min_age | string | 否 | 允许的最小买家年龄。	买家年龄必须大于等于所传数值 	注：	1. need_check_info=T时该参数才有效	2. min_age为整数，必须大于等于0 | `` |
| ext_user_info.mobile | string | 否 | 指定买家手机号。	注：该参数暂不校验 | `` |
| ext_user_info.name | string | 否 | 指定买家姓名。	注： need_check_info=T或fix_buyer=T时该参数才有效 | `` |
| ext_user_info.need_check_info | string | 否 | 是否强制校验买家信息；	需要强制校验传：T;	不需要强制校验传：F或者不传；	当传T时，支付宝会校验支付买家的信息与接口上传递的cert_type、cert_no、name或age是否匹配，只有接口传递了信息才会进行对应项的校验；只要有任何一项信息校验不匹配交易都会失败。如果传递了need_check_info，但是没有传任何校验项，则不进行任何校验。	默认为不校验。 | `` |
| extend_params.card_type | string | 否 | 卡类型 | `` |
| extend_params.credit_ext_info | string | 否 | 信用参数，可选，如有需要请与芝麻约定后传入，信用服务说明见 | `` |
| extend_params.hb_fq_num | string | 否 | 使用花呗分期要进行的分期数 | `` |
| extend_params.hb_fq_seller_percent | string | 否 | 使用花呗分期需要卖家承担的手续费比例的百分值，传入100代表100% | `` |
| extend_params.industry_reflux_info | string | 否 | 行业数据回流信息, 详见：地铁支付接口参数补充说明 | `` |
| extend_params.royalty_freeze | string | 否 | 是否进行资金冻结，用于后续分账，true表示资金冻结，false或不传表示资金不冻结 | `` |
| extend_params.specified_seller_name | string | 否 | 特殊场景下，允许商户指定交易展示的卖家名称 | `` |
| extend_params.sys_service_provider_id | string | 否 | 系统商编号	该参数作为系统商返佣数据提取的依据，请填写系统商签约协议的PID | `` |
| extend_params.tc_installment_order_id | string | 否 | 公域商品交易分期单ID，小程序交易组件订单特殊场景使用，请传入 订单分期接口(alipay.open.mini.order.installment.create)中返回的installment_order_id | `` |
| extend_params.trade_component_order_id | string | 否 | 公域商品交易业务订单ID | `` |
| goods_detail | array | 否 | 订单包含的商品列表信息.json格式. 其它说明详见：“商品明细说明” | `` |
| merchant_order_no | string | 否 | 商户的原始订单号 | `20161008001` |
| notify_url | string | 否 | 通知地址 | `` |
| operator_id | string | 否 | 商户操作员编号。 | `yx_001` |
| out_trade_no | string | 否 | 商户订单号。	由商家自定义，64个字符以内，仅支持字母、数字、下划线且需保证在商户端不重复。 | `20150320010101001` |
| passback_params | string | 否 | 公用回传参数。	如果请求时传递了该参数，支付宝会在异步通知时将该参数原样返回。 | `merchantBizType%3d3C%26merchantBizNo%3d2016010101111` |
| product_code | string | 否 | 产品码。	商家和支付宝签约的产品码。 枚举值（点击查看签约情况）：	<a target="_blank" href="https://opensupport.alipay.com/support/codelab/detail/486/487">FACE_TO_FACE_PAYMENT</a>：当面付产品；	默认值为FACE_TO_FACE_PAYMENT。 | `FACE_TO_FACE_PAYMENT` |
| qr_code_timeout_express | string | 否 | 二维码订单相对超时时间。	该笔订单允许的最晚付款时间，逾期将关闭交易，从生成二维码开始计时。 取值范围：1m～15d。m-分钟，h-小时，d-天，1c-当天（1c-当天的情况下，无论交易何时创建，都在0点关闭）。 该参数数值不接受小数点， 如 1.5h，可转换为 90m。	注：二维码最长有效期是2小时，不管该参数传递的值是多少，超过2小时后二维码都将失效不能再进行扫码支付。 | `90m` |
| query_options | array | 否 | 返回参数选项。 商户通过传递该参数来定制需要额外返回的信息字段，数组格式。包括但不限于：["hyb_amount","enterprise_pay_info"] | `["hyb_amount","enterprise_pay_info"]` |
| royalty_info.royalty_detail_infos | array | 否 | 分账明细的信息，可以描述多条分账指令，json数组。 | `` |
| royalty_info.royalty_type | string | 否 | 分账类型	卖家的分账类型，目前只支持传入ROYALTY（普通分账类型）。 | `` |
| seller_id | string | 否 | 卖家支付宝用户ID。	当需要指定收款账号时，通过该参数传入，如果该值为空，则默认为商户签约账号对应的支付宝用户ID。	收款账号优先级规则：门店绑定的收款账户>请求传入的seller_id>商户签约账号对应的支付宝用户ID；	注：直付通和机构间联场景下seller_id无需传入或者保持跟pid一致；	如果传入的seller_id与pid不一致，需要联系支付宝小二配置收款关系； | `2088102146225135` |
| settle_info.settle_detail_infos | array | 否 | 结算详细信息，json数组，目前只支持一条。 | `` |
| settle_info.settle_period_time | string | 否 | 该笔订单的超期自动确认结算时间，到达期限后，将自动确认结算。此字段只在签约账期结算模式时有效。取值范围：1d～365d。d-天。 该参数数值不接受小数点。 | `` |
| store_id | string | 否 | 商户门店编号。	指商户创建门店时输入的门店编号。 | `NJ_001` |
| sub_merchant.merchant_id | string | 否 | 支付宝二级商户编号。	间连受理商户的支付宝商户编号，通过间连商户入驻接口后由支付宝生成。	直付通和机构间连业务场景下必传。 | `` |
| sub_merchant.merchant_type | string | 否 | 二级商户编号类型。	枚举值：	alipay:支付宝分配的间联商户编号；	目前仅支持alipay，默认可以不传。 | `` |
| subject | string | 否 | 订单标题。	注意：不可使用特殊字符，如 /，=，& 等。 | `Iphone6 16G` |
| terminal_id | string | 否 | 商户机具终端编号。 | `NJ_T_001` |
| time_expire | string | 否 | 订单绝对超时时间。	格式为yyyy-MM-dd HH:mm:ss。	注：time_expire和timeout_express两者只需传入一个或者都不传，如果两者都传，优先使用time_expire。 | `2021-12-31 10:05:00` |
| timeout_express | string | 否 | 订单相对超时时间。 从预下单请求时间开始计算。	该笔订单允许的最晚付款时间，逾期将关闭交易。取值范围：1m～15d。m-分钟，h-小时，d-天，1c-当天（1c-当天的情况下，无论交易何时创建，都在0点关闭）。 该参数数值不接受小数点， 如 1.5h，可转换为 90m。 	当面付场景默认值为3h，如需指定，推荐设置5m及以上		注：	1. 二维码最长有效期是2小时，不管该参数传递的值是多少，超过2小时后二维码都将失效不能再进行扫码支付。	2. time_expire和timeout_express两者只需传入一个或者都不传，如果两者都传，优先使用time_expire。 | `90m` |
| total_amount | string | 否 | 订单总金额。	单位为元，精确到小数点后两位，取值范围：[0.01,100000000] 。 | `88.88` |
| undiscountable_amount | string | 否 | 不可打折金额。	不参与优惠计算的金额，单位为元，精确到小数点后两位，取值范围[0.01,100000000]。 	如果同时传入了【可打折金额】、【不可打折金额】和【订单总金额】，则必须满足如下条件：【订单总金额】=【可打折金额】+【不可打折金额】。	如果订单金额全部参与优惠计算，则【可打折金额】和【不可打折金额】都无需传入。 | `8.88` |

## 返回结果

- **Content-Type**：`application/json`

### 返回参数

| 字段名 | 类型 | 说明 | 示例值 |
|--------|------|------|--------|
| out_trade_no | string | 商户的订单号 | `6823789339978248` |
| qr_code | string | 当前预下单请求生成的二维码码串，有效时间2小时，可以用二维码生成工具根据该码串值生成对应的二维码 | `https://qr.alipay.com/bavh4wjlxf12tper3a` |
| share_code | string | 当前预下单请求生成的吱口令码串，有效时间2小时，可以在支付宝app端访问对应内容 | `chb4n8A94Qc` |

### 成功响应示例

```json
{
  "code": "10000",
  "msg": "Success",
  "out_trade_no": "6823789339978248",
  "qr_code": "https://qr.alipay.com/bavh4wjlxf12tper3a",
  "share_code": "chb4n8A94Qc"
}
```

### 失败响应示例

```json
{
  "code": "40004",
  "msg": "Business Failed",
  "sub_code": "ACQ.TRADE_HAS_SUCCESS",
  "sub_msg": "交易已被支付"
}
```

## 状态码说明

| 状态码 | 说明 |
|--------|------|
| 10000  | 业务处理成功 |
| 40004  | 业务处理失败 |
| 20000  | 服务不可用 |

## 请求示例 (cURL)

```bash
curl -X POST https://openapi.alipay.com/v3/alipay/trade/precreate \
  -H "Content-Type: application/json" \
  -d '{
  "alipay_store_id": "2016052600077000000015640104",
  "bkagent_req_info": {
    "acq_code": "string",
    "device_type": "string",
    "location": "string",
    "merch_code": "string",
    "serial_num": "string"
  },
  "body": "Iphone6 16G",
  "business_params": {
    "actual_order_time": "string",
    "buyer_memo": "string",
    "campus_card": "string",
    "card_type": "string",
    "enterprise_pay_amount": "string",
    "enterprise_pay_info": "string",
    "force_pwd": "string",
    "good_taxes": "string",
    "mc_create_trade_ip": "string",
    "priority_unfreeze_asset": "string",
    "tiny_app_merchant_biz_type": "string"
  },
  "buyer_logon_id": "15901825620",
  "code_type": "share_code",
  "disable_pay_channels": "pcredit,moneyFund,debitCardExpress",
  "discountable_amount": "80.00",
  "enable_pay_channels": "pcredit,moneyFund,debitCardExpress",
  "ext_user_info": {
    "cert_no": "string",
    "cert_type": "string",
    "fix_buyer": "string",
    "identity_hash": "string",
    "min_age": "string",
    "mobile": "string",
    "name": "string",
    "need_check_info": "string"
  },
  "extend_params": {
    "card_type": "string",
    "credit_ext_info": "string",
    "hb_fq_num": "string",
    "hb_fq_seller_percent": "string",
    "industry_reflux_info": "string",
    "royalty_freeze": "string",
    "specified_seller_name": "string",
    "sys_service_provider_id": "string",
    "tc_installment_order_id": "string",
    "trade_component_order_id": "string"
  },
  "goods_detail": [
    {
      "alipay_goods_id": "string",
      "body": "string",
      "categories_tree": "string",
      "goods_category": "string",
      "goods_id": "string",
      "goods_name": "string",
      "out_item_id": "string",
      "out_sku_id": "string",
      "price": "string",
      "quantity": "integer",
      "show_url": "string"
    }
  ],
  "merchant_order_no": "20161008001",
  "notify_url": "string",
  "operator_id": "yx_001",
  "out_trade_no": "20150320010101001",
  "passback_params": "merchantBizType%3d3C%26merchantBizNo%3d2016010101111",
  "product_code": "FACE_TO_FACE_PAYMENT",
  "qr_code_timeout_express": "90m",
  "query_options": [
    "string"
  ],
  "royalty_info": {
    "royalty_detail_infos": [
      {
        "amount": "string",
        "amount_percentage": "string",
        "batch_no": "string",
        "desc": "string",
        "out_relation_id": "string",
        "serial_no": "integer",
        "trans_in": "string",
        "trans_in_type": "string",
        "trans_out": "string",
        "trans_out_type": "string"
      }
    ],
    "royalty_type": "string"
  },
  "seller_id": "2088102146225135",
  "settle_info": {
    "settle_detail_infos": [
      {
        "actual_amount": "string",
        "amount": "string",
        "settle_entity_id": "string",
        "settle_entity_type": "string",
        "summary_dimension": "string",
        "trans_in": "string",
        "trans_in_type": "string"
      }
    ],
    "settle_period_time": "string"
  },
  "store_id": "NJ_001",
  "sub_merchant": {
    "merchant_id": "string",
    "merchant_type": "string"
  },
  "subject": "Iphone6 16G",
  "terminal_id": "NJ_T_001",
  "time_expire": "2021-12-31 10:05:00",
  "timeout_express": "90m",
  "total_amount": "88.88",
  "undiscountable_amount": "8.88"
}'
```
