# 统一收单交易撤销接口

## 功能说明

**接口名称**：`alipay.trade.cancel`

支付交易返回失败或支付系统超时，调用该接口撤销交易。如果此订单用户支付失败，支付宝系统会将此订单关闭；如果用户支付成功，支付宝系统会将此订单资金退还给用户。
注意：只有发生支付系统超时或者支付结果未知时可调用撤销，其他正常支付的单如需实现相同功能请调用申请退款API。提交支付交易后调用【查询订单API】，没有明确的支付结果再调用【撤销订单API】。

## 请求

- **URL**：`/v3/alipay/trade/cancel`
- **Method**：`POST`
- **Content-Type**：`application/json`

### 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| out_trade_no | string | 否 | 原支付请求的商户订单号,和支付宝交易号不能同时为空 | `20150320010101001` |
| trade_no | string | 否 | 支付宝交易号，和商户订单号不能同时为空 | `2014112611001004680073956707` |

## 返回结果

- **Content-Type**：`application/json`

### 返回参数

| 字段名 | 类型 | 说明 | 示例值 |
|--------|------|------|--------|
| action | string | 本次撤销触发的交易动作,接口调用成功且交易存在时返回。可能的返回值：	close：交易未支付，触发关闭交易动作，无退款；	refund：交易已支付，触发交易退款动作；	未返回：未查询到交易，或接口调用失败； | `close` |
| gmt_refund_pay | string | 当撤销产生了退款时，返回退款时间；	 只在银行间联交易场景下返回该信息； | `2016-11-27 15:45:57` |
| out_trade_no | string | 商户订单号 | `6823789339978248` |
| refund_settlement_id | string | 当撤销产生了退款时，返回的退款清算编号，用于清算对账使用；	只在银行间联交易场景下返回该信息； | `2018101610032004620239146945` |
| retry_flag | string | 是否需要重试 | `N` |
| trade_no | string | 支付宝交易号;	当发生交易关闭或交易退款时返回； | `2013112011001004330000121536` |

### 成功响应示例

```json
{
  "code": "10000",
  "msg": "Success",
  "action": "close",
  "gmt_refund_pay": "2016-11-27 15:45:57",
  "out_trade_no": "6823789339978248",
  "refund_settlement_id": "2018101610032004620239146945",
  "retry_flag": "N",
  "trade_no": "2013112011001004330000121536"
}
```

### 失败响应示例

```json
{
  "code": "40004",
  "msg": "Business Failed",
  "sub_code": "ACQ.TRADE_HAS_SUCCESS",
  "sub_msg": "交易已被支付"
}
```

## 状态码说明

| 状态码 | 说明 |
|--------|------|
| 10000  | 业务处理成功 |
| 40004  | 业务处理失败 |
| 20000  | 服务不可用 |

## 请求示例 (cURL)

```bash
curl -X POST https://openapi.alipay.com/v3/alipay/trade/cancel \
  -H "Content-Type: application/json" \
  -d '{
  "out_trade_no": "20150320010101001",
  "trade_no": "2014112611001004680073956707"
}'
```
