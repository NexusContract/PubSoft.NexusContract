{
  "/*": "==============================================",
  "//": "NexusContract ISV 多租户配置示例",
  "//": "此文件展示如何配置多个商户",
  "/*": "==============================================",

  "Redis": {
    "ConnectionString": "localhost:6379,abortConnect=false"
  },

  "Security": {
    "//": "AES 主密钥（用于加密 PrivateKey）",
    "//": "生产环境必须使用 Azure KeyVault 或 AWS Secrets Manager",
    "MasterKey": "DEMO-MASTER-KEY-32-BYTES-LONG!"
  },

  "//": "==============================================",
  "//": "多租户配置存储在 Redis/数据库",
  "//": "以下为配置结构示例（实际由 HybridConfigResolver 从 L2/L3 加载）",
  "//": "==============================================",

  "TenantConfigurations": {
    "merchant_001": {
      "RealmId": "merchant_001",
      "ProfileId": "2021000122639876",
      "ProviderName": "Alipay",
      "GatewayUrl": "https://openapi.alipay.com/",
      "AppId": "2021000122639876",
      "MerchantId": "2088123456789012",
      "PrivateKey": "MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC...",
      "AlipayPublicKey": "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...",
      "UseSandbox": false,
      "RequestTimeout": "00:00:30",
      "ExtendedSettings": {
        "ImplementationName": "Alipay",
        "MerchantName": "测试商户001",
        "Industry": "Retail"
      }
    },

    "merchant_002": {
      "RealmId": "merchant_002",
      "ProfileId": "2021000122639877",
      "ProviderName": "Alipay",
      "GatewayUrl": "https://openapi-sandbox.dl.alipaydev.com/",
      "AppId": "2021000122639877",
      "MerchantId": "2088123456789013",
      "PrivateKey": "MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQD...",
      "AlipayPublicKey": "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...",
      "UseSandbox": true,
      "RequestTimeout": "00:00:30",
      "ExtendedSettings": {
        "ImplementationName": "Alipay",
        "MerchantName": "沙箱商户002",
        "Industry": "Education"
      }
    },

    "sp_partner_isv": {
      "//": "ISV 服务商模式（支付宝授权代扣）",
      "RealmId": "sp_partner_isv",
      "ProfileId": "2021000122639878",
      "ProviderName": "Alipay",
      "GatewayUrl": "https://openapi.alipay.com/",
      "AppId": "2021000122639878",
      "MerchantId": "2088123456789014",
      "PrivateKey": "MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQD...",
      "AlipayPublicKey": "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...",
      "UseSandbox": false,
      "RequestTimeout": "00:00:45",
      "ExtendedSettings": {
        "ImplementationName": "Alipay",
        "MerchantName": "ISV服务商",
        "Industry": "ISV_SERVICE",
        "IsServiceProvider": true,
        "sub_mch_id": "2088XXXXXXXXX"
      }
    }
  },

  "//": "==============================================",
  "//": "多租户请求示例",
  "//": "==============================================",

  "UsageExamples": {
    "example_1_header": {
      "description": "通过 HTTP Header 指定租户",
      "method": "POST",
      "url": "http://localhost:5000/v3/alipay/trade/pay",
      "headers": {
        "X-Tenant-Id": "merchant_001",
        "Content-Type": "application/json"
      },
      "body": {
        "merchantOrderNo": "ORDER_20250113_001",
        "totalAmount": 100.00,
        "subject": "测试订单001",
        "scene": "bar_code",
        "authCode": "285015833990941919"
      }
    },

    "example_2_query": {
      "description": "通过 Query 参数指定租户",
      "method": "POST",
      "url": "http://localhost:5000/v3/alipay/trade/pay?tenantId=merchant_002",
      "headers": {
        "Content-Type": "application/json"
      },
      "body": {
        "merchantOrderNo": "ORDER_20250113_002",
        "totalAmount": 88.88,
        "subject": "沙箱订单002",
        "scene": "bar_code",
        "authCode": "285015833990941920"
      }
    },

    "example_3_json_body": {
      "description": "通过 JSON Body 指定租户",
      "method": "POST",
      "url": "http://localhost:5000/v3/alipay/trade/pay",
      "headers": {
        "Content-Type": "application/json"
      },
      "body": {
        "realm_id": "sp_partner_isv",
        "profile_id": "2021000122639878",
        "provider_name": "Alipay",
        "merchantOrderNo": "ORDER_20250113_003",
        "totalAmount": 200.00,
        "subject": "ISV代扣订单003",
        "scene": "bar_code",
        "authCode": "285015833990941921"
      }
    }
  },

  "//": "==============================================",
  "//": "配置缓存策略",
  "//": "==============================================",

  "CacheStrategy": {
    "L1": {
      "Type": "MemoryCache",
      "TTL": "00:05:00",
      "Description": "进程内缓存，5分钟 TTL"
    },
    "L2": {
      "Type": "Redis",
      "TTL": "00:30:00",
      "Description": "跨实例共享，30分钟 TTL，支持 Pub/Sub 失效通知"
    },
    "L3": {
      "Type": "Database (TODO)",
      "Description": "ITenantRepository 接口待实现"
    }
  },

  "//": "==============================================",
  "//": "架构流程说明",
  "//": "==============================================",

  "ArchitectureFlow": {
    "1": "HTTP 请求 → FastEndpoints",
    "2": "TenantContextFactory.CreateAsync(HttpContext) → 提取租户身份",
    "3": "INexusEngine.ExecuteAsync(request, identity, ct) → 调度引擎",
    "4": "HybridConfigResolver.ResolveAsync(identity) → L1/L2/L3 加载配置",
    "5": "IProvider.ExecuteAsync(request, config, ct) → AlipayProviderAdapter",
    "6": "AlipayProviderAdapter 缓存 AlipayProviderConfig（~1KB）",
    "7": "AlipayProvider.ExecuteAsync(request, ct) → 业务逻辑",
    "8": "INexusTransport (YARP) → HTTP/2 + Retry + Circuit Breaker",
    "9": "支付宝 OpenAPI v3 → 返回响应"
  }
}
