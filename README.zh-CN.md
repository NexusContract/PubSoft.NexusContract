# NexusContractï¼ˆç²¾è‹±ç‰ˆï¼‰

> **[English](./README.md)** | **ä¸­æ–‡æ–‡æ¡£ï¼ˆå½“å‰ï¼‰**

**Kernelized Contract Integrationï¼ˆKCIï¼‰æ¡†æ¶**  
ä¸€ä¸ªä»¥ã€Œå¯åŠ¨æœŸæ ¡éªŒã€ä¸ºæ ¸å¿ƒçš„ **å¥‘çº¦æ‰§è¡Œå†…æ ¸**ï¼Œ  
ç”¨äºæ”¯ä»˜ä¸ç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆï¼ŒåŸºäº **.NET Standard 2.0 + .NET 10**ã€‚

> **â€œæ˜¾å¼è¾¹ç•Œï¼Œä¼˜äºéšå¼é­”æ³•ã€‚â€**  
> è¿™ä¸æ˜¯å£å·ï¼Œè€Œæ˜¯ NexusContract çš„å®ªæ³•çº§è®¾è®¡åŸåˆ™ã€‚

> ## ğŸ“ æ¶æ„è“å›¾ (v1.1 â€” Provider ç‰©ç†æ‰©å±•ä¸è·¨äº‘æ”¯æŒ)
> å®Œæ•´è“å›¾è¯·å‚é˜…ï¼š`docs/ARCHITECTURE_BLUEPRINT.zh-CN.md`ï¼ˆv1.1ï¼Œ2026â€‘01â€‘10ï¼‰ã€‚  
> **å½“å‰ä»£ç åº“ï¼š** `v1.0.0â€‘preview.10` â€” å·²å®ç°è“å›¾çš„æ ¸å¿ƒå®ªæ³•çº¦æŸï¼ˆå¯åŠ¨æœŸæ ¡éªŒã€é›¶åå°„ã€ç¡®å®šæ€§æ‰§è¡Œï¼‰ï¼ŒISV æ‰©å±•ï¼ˆJIT Resolverã€Realm/Profileã€YarpTransportï¼‰æ­£åœ¨å—æ§ç¯å¢ƒä¸­é€æ­¥è½åœ°ã€‚æ›¿æ¢éªŒè¯å®Œæˆåå°†æ›´æ–°æ–‡æ¡£ä»¥åæ˜ æœ€ç»ˆè¦†ç›–æƒ…å†µã€‚

æœ¬æ¡†æ¶æ‰€æœ‰è®¾è®¡å‡å›´ç»•ä»¥ä¸‹ç›®æ ‡å±•å¼€ï¼š

- **ç¡®å®šæ€§ï¼ˆDeterminismï¼‰**
- **å¯è§‚æµ‹æ€§ï¼ˆObservabilityï¼‰**
- **æ¶æ„çº¦æŸï¼ˆArchitectural Constraintsï¼‰**
- **Fail-Fast æ­£ç¡®æ€§ï¼ˆå¯åŠ¨å³å¤±è´¥ï¼Œè€Œéè¿è¡ŒæœŸè¡¥æ•‘ï¼‰**

---

## ğŸ§­ NexusContract è§£å†³çš„æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿ

åœ¨çœŸå®çš„æ”¯ä»˜ / ä¸‰æ–¹é›†æˆåœºæ™¯ä¸­ï¼Œæ™®éå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

- OpenAPIã€RPCã€ç§æœ‰æ¥å£ **é•¿æœŸå¹¶å­˜**
- åŒä¸€ä¸ªä¸šåŠ¡è¯­ä¹‰ï¼Œåœ¨ä¸åŒåè®®ä¸­æœ‰ **ä¸åŒè¡¨è¾¾**
- ä¸€ä¸ªåŠ å¯†å­—æ®µæ¼å†™åç§°ï¼Œ**ä¸æ˜¯ Bugï¼Œè€Œæ˜¯äº‹æ•…**
- ç­‰åˆ°è¿è¡ŒæœŸæ‰å‘ç°é—®é¢˜ï¼Œ**å·²ç»å¤ªæ™š**

ä¼ ç»Ÿæ¡†æ¶é€šå¸¸å°† Contract è§†ä¸ºï¼š

- DTO
- è¿è¡ŒæœŸé…ç½®
- çµæ´»æ˜ å°„è§„åˆ™

**NexusContract çš„æ ¸å¿ƒç«‹åœºæ˜¯ï¼š**

> Contract ä¸æ˜¯é…ç½®ï¼Œè€Œæ˜¯ã€Œç³»ç»Ÿå¿…é¡»éµå®ˆçš„çº¦æŸã€ã€‚  
> å¦‚æœçº¦æŸä¸æˆç«‹ï¼Œç³»ç»Ÿä¸åº”å¯åŠ¨ã€‚

---

## ğŸ›ï¸ æ ¸å¿ƒæ¶æ„ï¼šä» REPR åˆ° REPR-P

NexusContract åŸºäº  
[FastEndpoints](https://fast-endpoints.com/) çš„ **REPRï¼ˆRequestâ€“Endpointâ€“Responseï¼‰** æ¨¡å‹ï¼Œ
å¼•å…¥ **Proxyï¼ˆä»£ç†ï¼‰** æ¦‚å¿µï¼Œå½¢æˆ **REPR-P æ¶æ„æ¨¡å‹**ã€‚

### REPR-P æ‹†è§£è¯´æ˜

- **R â€” Requestï¼ˆè¯·æ±‚ï¼‰**  
  å¼ºç±»å‹çš„ä¸šåŠ¡æ„å›¾  
  `IApiRequest<TResponse>`

- **E â€” Endpointï¼ˆç«¯ç‚¹ï¼‰**  
  **é›¶ä¸šåŠ¡ä»£ç **  
  ä»…è´Ÿè´£åè®®æ‰¿è½½ä¸è½¬å‘

- **R â€” Responseï¼ˆå“åº”ï¼‰**  
  å¼ºç±»å‹çš„ä¸šåŠ¡ç»“æœ

- **P â€” Proxyï¼ˆä»£ç† / å†…æ ¸ï¼‰**  
  `NexusGateway`  
  æ‰§è¡Œç»Ÿä¸€ç®¡é“ï¼Œå¹¶å°†è¯·æ±‚è·¯ç”±è‡³å…·ä½“ Provider

> ä¸šåŠ¡é€»è¾‘ä¸ä¸‹æ²‰åˆ°ä¼ è¾“å±‚  
> ä¼ è¾“ç»†èŠ‚ä¸ä¸Šæµ®åˆ°å¥‘çº¦å±‚

---

## ğŸ§­ å¥‘çº¦æ˜¯â€œå®ªæ³•â€ï¼Œä¸æ˜¯â€œé…ç½®â€

åœ¨ NexusContract ä¸­ï¼Œä¸€ä¸ª Contract **ä¸æ˜¯**ï¼š

- DTO
- å¯é€‰é…ç½®
- ç¯å¢ƒç›¸å…³æ˜ å°„

è€Œæ˜¯ä¸€ä¸ª **å®ªæ³•çº§æ„ä»¶**ã€‚

### è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿ

- âŒ ä¸å…è®¸é™é»˜é™çº§
- âŒ ä¸å…è®¸è¿è¡ŒæœŸçŒœæµ‹
- âŒ ä¸å…è®¸ç¯å¢ƒå·®å¼‚ç»•è¿‡
- âœ… è¦ä¹ˆå®Œå…¨åˆè§„ï¼Œè¦ä¹ˆ **æ‹’ç»å¯åŠ¨**

### ä¸ºä»€ä¹ˆå¿…é¡»è¿™ä¹ˆä¸¥æ ¼ï¼Ÿ

å› ä¸ºåœ¨æ”¯ä»˜ç³»ç»Ÿä¸­ï¼š

- åŠ å¯†å­—æ®µ **å¿…é¡»æ˜¾å¼å£°æ˜åç§°**
- åè®®æŠ•å½± **å¿…é¡»ç¡®å®š**
- é”™è¯¯å¿…é¡»åœ¨ **æµé‡è¿›å…¥å‰** æš´éœ²

NexusContract çš„åŸºæœ¬åŸåˆ™æ˜¯ï¼š

> **æ‰€æœ‰è¿åå¥‘çº¦çš„è¡Œä¸ºï¼Œéƒ½å¿…é¡»åœ¨å¯åŠ¨æœŸä¸€æ¬¡æ€§æš´éœ²å‡ºæ¥ã€‚**

---

## ğŸš€ æ ¸å¿ƒèƒ½åŠ›æ¦‚è§ˆ

### ğŸ”’ å¯åŠ¨æœŸå®ªæ³•ä½“æ£€ï¼ˆStartup Health Checkï¼‰

- å¯åŠ¨æ—¶ä¸€æ¬¡æ€§æ‰«ææ‰€æœ‰å¥‘çº¦
- æ ¡éªŒåŠ å¯†è§„åˆ™ã€å‘½åè§„åˆ™ã€åµŒå¥—æ·±åº¦ç­‰
- è‹¥å­˜åœ¨é˜»æ–­çº§é”™è¯¯ï¼Œ**æœåŠ¡ä¸å…è®¸å¯åŠ¨**

### ğŸ§  å…ƒæ•°æ®é©±åŠ¨ï¼Œè¿è¡ŒæœŸå†»ç»“

- å¯åŠ¨æœŸå®Œæˆæ‰€æœ‰æ‰«æä¸ç¼–è¯‘
- è¿è¡ŒæœŸ **é›¶åå°„**
- æ‰§è¡Œè·¯å¾„å‡ ä¹é›¶é¢å¤–åˆ†é…

### ğŸ”„ å››é˜¶æ®µç¡®å®šæ€§æ‰§è¡Œç®¡é“

æ‰€æœ‰è¯·æ±‚éƒ½å¿…é¡»ç»è¿‡ä»¥ä¸‹é˜¶æ®µï¼š

```

Validate â†’ Project â†’ Execute â†’ Hydrate

````

æ²¡æœ‰æ·å¾„ï¼Œä¹Ÿæ²¡æœ‰éšè—åˆ†æ”¯ã€‚

### ğŸ§¾ ç»“æ„åŒ–è¯Šæ–­ï¼ˆNXC é”™è¯¯ç ï¼‰

æ‰€æœ‰é”™è¯¯å‡å…·å¤‡ç¨³å®šçš„è¯Šæ–­ç ï¼š

- å¯åŠ¨æœŸï¼ˆé™æ€ï¼‰
- å‡ºç«™ï¼ˆè¯·æ±‚æŠ•å½±ï¼‰
- å…¥ç«™ï¼ˆå“åº”ååºåˆ—åŒ–ï¼‰

ç”¨äº **å®šä½é—®é¢˜ï¼Œè€Œéâ€œçœ‹æ—¥å¿—çŒœåŸå› â€**ã€‚

---

## ğŸ å¿«é€Ÿå¼€å§‹ï¼šå¯åŠ¨æœŸä½“æ£€

ç¤ºä¾‹æ¥è‡ª `Demo.Alipay.HttpApi`ï¼š

```csharp
// 1. æ‰«ææ‰€æœ‰ ApiOperation å¥‘çº¦
var types = AppDomain.CurrentDomain.GetAssemblies()
    .SelectMany(a => a.GetTypes())
    .Where(t => t.IsClass && !t.IsAbstract &&
                t.GetCustomAttribute<ApiOperationAttribute>() != null)
    .ToArray();

// 2. é¢„åŠ è½½å¹¶æ‰§è¡Œå…¨é‡æ ¡éªŒ
var report = NexusContractMetadataRegistry.Instance
    .Preload(types, warmup: true);

// 3. è¾“å‡ºä½“æ£€æŠ¥å‘Š
report.PrintToConsole(includeDetails: true);

// 4. å­˜åœ¨å®ªæ³•çº§é”™è¯¯åˆ™é˜»æ–­å¯åŠ¨
if (report.HasCriticalErrors)
{
    Environment.Exit(1);
}
````

### ç¤ºä¾‹è¾“å‡º

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           NexusContract å¥‘çº¦ä½“æ£€æŠ¥å‘Š                             â•‘
â•‘                    å¯åŠ¨æœŸå¥åº·æ£€æŸ¥                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ çŠ¶æ€: âœ… å¥åº·                                                   â•‘
â•‘ æ‰«æå¥‘çº¦æ•°: 6                                                   â•‘
â•‘ é—®é¢˜æ€»æ•°: 0                                                     â•‘
â•‘ é˜»æ–­çº§é”™è¯¯: 0                                                   â•‘
â•‘ è­¦å‘Š: 0                                                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

> æ‰€æœ‰é—®é¢˜ **ä¸€æ¬¡å¯åŠ¨å…¨éƒ¨æš´éœ²**ï¼Œè€Œä¸æ˜¯â€œä¿®ä¸€ä¸ªè·‘ä¸€æ¬¡â€ã€‚

---

## ğŸ¯ OperationIdï¼šä¸šåŠ¡æ„å›¾æ ‡è¯†ï¼Œè€Œéè·¯ç”±

`OperationId` è¡¨ç¤º **ä¸€ä¸ªä¸šåŠ¡æ„å›¾**ï¼Œ
è€Œä¸æ˜¯ HTTP è·¯å¾„æˆ–æ–¹æ³•ã€‚

```csharp
[ApiOperation("alipay.trade.query", HttpVerb.POST)]
public sealed class TradeQueryRequest
    : IApiRequest<TradeQueryResponse> { }
```

### å¥‘çº¦åœ¨å¤šå±‚æ¶æ„ä¸­çš„ä¸€è‡´æ˜ å°„

ä¸€ä¸ª NexusContract åœ¨ç³»ç»Ÿä¸­ä¿æŒè¯­ä¹‰ä¸€è‡´ï¼š

* **BFF**

  * å¯¹å¤–æš´éœ²ï¼š`/api/alipay/v3/trade/query`

* **HttpApi**

  * åŸæ ·ä»£ç†ï¼š`/api/alipay/v3/trade/query`

* **Provider**

  * å®é™…è°ƒç”¨ï¼š

    * OpenAPIï¼š`/v3/alipay/trade/query`
    * RPCï¼š`alipay.trade.query`

---

## ğŸ—ï¸ ä¸‰å±‚æ¶æ„æ¨¡å‹

```mermaid
flowchart TB
    BFF["BFF / ä¸šåŠ¡å±‚<br/>(Layer 2)<br/>NexusGatewayClient"]
    API["HttpApi å±‚<br/>(Layer 1)<br/>FastEndpoints"]
    Provider["Provider å±‚<br/>(Layer 0)<br/>AlipayProvider"]
    OpenAPI["æ”¯ä»˜å® OpenAPI / RPC"]

    BFF -->|HTTP| API
    API -->|ç›´è°ƒ| Provider
    Provider --> OpenAPI
```

### ç›´æ¥é›†æˆï¼ˆè·³è¿‡ HttpApiï¼‰

```mermaid
flowchart TB
    App["ä½ çš„åº”ç”¨"]
    Provider["AlipayProvider"]
    OpenAPI["æ”¯ä»˜å® OpenAPI / RPC"]

    App --> Provider
    Provider --> OpenAPI
```

---

## âš™ï¸ FastEndpoints çš„è§’è‰²å®šä½

FastEndpoints **ä¸æ˜¯ NexusContract çš„æ ¸å¿ƒ**ã€‚

å®ƒåªæ˜¯ï¼š

> ä¸€ä¸ªéå¸¸å¥‘åˆ HttpApi å±‚èŒè´£çš„å®ç°é€‰æ‹©ã€‚

### ä¸ºä»€ä¹ˆé€‰ FastEndpointsï¼Ÿ

* Endpoint æ¨¡å‹æ˜¾å¼
* æ—  Controller é­”æ³•
* æ€§èƒ½ç¨³å®š
* ä¸ REPR æ¨¡å¼å¤©ç„¶å¥‘åˆ

> NexusContract åœ¨æ¦‚å¿µä¸Š **ä¸ä¾èµ– FastEndpoints**ã€‚

ä½ å¯ä»¥æ›¿æ¢ä¸ºï¼š

* ASP.NET Minimal API
* MVC
* gRPC Gateway
* è‡ªå®šä¹‰åè®®æœåŠ¡

---

## ğŸ¤– å…³äº AI å‹å¥½æ€§

NexusContract å¹¶é AI ä¼˜å…ˆæ¡†æ¶ã€‚

ä½†ç”±äºå…¶ï¼š

* å¥‘çº¦æ˜¾å¼
* å…ƒæ•°æ®å†»ç»“
* æ‰§è¡Œè·¯å¾„ç¡®å®š

å®ƒå¤©ç„¶é€‚åˆï¼š

* LLM ç”Ÿæˆä»£ç 
* Tool / Agent è°ƒç”¨
* é™æ€åˆ†æä¸å¥‘çº¦è‡ªçœ

è¿™æ˜¯ **ä¸¥è°¨æ¶æ„çº¦æŸçš„è‡ªç„¶ç»“æœ**ï¼Œè€Œéè®¾è®¡ç›®æ ‡ã€‚

---

## ğŸ“¦ NuGet åŒ…ç»“æ„

| åŒ…å                             | ç›®æ ‡æ¡†æ¶           | è¯´æ˜                         |
| ------------------------------ | -------------- | -------------------------- |
| NexusContract.Abstractions     | netstandard2.0 | æ ¸å¿ƒæŠ½è±¡ï¼Œæ— å¤–éƒ¨ä¾èµ–                 |
| NexusContract.Core             | .NET 10        | å¥‘çº¦æ‰§è¡Œå†…æ ¸                     |
| NexusContract.Client           | .NET 10        | BFF / ä¸šåŠ¡å±‚å®¢æˆ·ç«¯               |
| NexusContract.Providers.Alipay | .NET 10        | æ”¯ä»˜å® OpenAPI / RPC Provider |

---

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### HttpApi å±‚

```csharp
public sealed class TradeQueryEndpoint(AlipayProvider provider)
    : AlipayEndpointBase<TradeQueryRequest>(provider) { }
```

### BFF / ä¸šåŠ¡å±‚

```csharp
var client = new NexusGatewayClient(
    httpClient,
    new SnakeCaseNamingPolicy());

var response = await client.SendAsync(
    new TradeQueryRequest { TradeNo = "202501..." });
```

### Provider ç›´è°ƒ

```csharp
var provider = new AlipayProvider(appId, privateKey, publicKey);

var response = await provider.ExecuteAsync(
    new TradeQueryRequest { TradeNo = "202501..." });
```

---

## ğŸ¯ æ€§èƒ½ç‰¹å¾

* è¿è¡ŒæœŸé›¶åå°„
* å†»ç»“å…ƒæ•°æ®å­—å…¸
* é¢„ç¼–è¯‘ IL è®¿é—®å™¨

å®Œæ•´æ‰§è¡Œé“¾è·¯çº¦ **~120ns**

---

## ğŸš« éç›®æ ‡è¯´æ˜

NexusContract ä¸å°è¯•ï¼š

* æ¨æ–­ç¼ºå¤±å­—æ®µ
* æä¾›è¿è¡ŒæœŸè‡ªåŠ¨ä¿®å¤
* ä½œä¸ºé€šç”¨æµç¨‹å¼•æ“

---

## ğŸ§  æ€»ç»“

> **NexusContract æ˜¯ä¸€ä¸ªå°†é›†æˆè§†ä¸ºâ€œå®ªæ³•æ‰§è¡Œâ€çš„è¿è¡Œæ—¶å†…æ ¸ï¼Œ
> ç”¨äºé‚£äº›ä¸èƒ½é â€œçº¦å®šâ€å’Œâ€œç»éªŒâ€å…œåº•çš„ç³»ç»Ÿã€‚**

---

## ğŸ“„ License

MIT License

```